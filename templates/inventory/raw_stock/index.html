<!-- File path: templates/inventory/raw_stock/index.html -->
{% extends "base.html" %}

{% set current_sort = request.args.get('sort', 'code') %}
{% set current_dir  = request.args.get('dir', 'desc') %}

{% macro sort_th(label, key) %}
  {% set is_active = (current_sort == key) %}
  {% set next_dir = 'asc' if (is_active and current_dir == 'desc') else 'desc' %}

  <a href="{{ url_for('inventory_bp.raw_stock_index',
                      sort=key,
                      dir=next_dir,
                      q=request.args.get('q'),
                      show_inactive=request.args.get('show_inactive')) }}"
     style="display:inline-flex; gap:6px; align-items:center; text-decoration:none; color:inherit;">
    <span>{{ label }}</span>
    <span class="muted">
      {% if is_active %}
        {{ '‚ñ≤' if current_dir == 'asc' else '‚ñº' }}
      {% else %}
        ‚ñæ
      {% endif %}
    </span>
  </a>
{% endmacro %}


{% block title %}Raw Stock{% endblock %}
{% block topbar %}üß± Inventory{% endblock %}

{% block toplinks %}
  <span class="page-links">
    <a class="btn btn-secondary" href="{{ url_for('inventory_bp.inventory_index') }}">‚Üê Inventory</a>
    <a class="btn btn-primary" href="{{ url_for('inventory_bp.inventory_catalog') }}">‚Üê Catalog</a>    

    
  </span>
  {{ super() }}
{% endblock %}


{% block content %}
<div class="page">
  <div class="page-header">
    <div>
      <h1 class="page-title">Raw Stock</h1>
      <p class="page-subtitle">Sheet goods, bar stock, handle materials</p>
    </div>

   
  </div>
    <form method="get" class="mb-3">
      <input type="text" name="q" value="{{ search }}" placeholder="Search‚Ä¶" />
      <label>
        <input type="checkbox" name="show" value="all" {% if include_inactive %}checked{% endif %}>
        Show inactive
      </label>
      <button type="submit">Filter</button>
    </form>

  <div class="card">
    <table class="table">
      <thead>
        <tr>
          <th>{{ sort_th('Code', 'code') }}</th>
          <th>{{ sort_th('Material', 'material') }}</th>
          <th>{{ sort_th('Name', 'name') }}</th> 
          <th>{{ sort_th('Grade', 'grade') }}</th>
          <th style="width:120px;">{{ sort_th('Form', 'form') }}</th>
          <th style="width:160px;">Thickness</th>
          <th style="width:200px;">Size</th>
          <th style="width:160px;">Quantity</th>
          <th style="width:180px;">Location</th>
          <th><a href="{{ url_for('inventory_bp.raw_stock_new') }}" class="btn btn-secondary" style="align:center;">
               ‚úö
              </a>
          </th>
        </tr>
      </thead>
      <tbody>
        {% for r in items %}
          <tr class="{% if not r.is_active %}muted{% endif %}">
            <td>
              <a href="{{ url_for('inventory_bp.raw_stock_details', item_id=r.id) }}"
                 style="font-weight:600;">
                RS-{{ "%05d"|format(r.id) }}
              </a>
            </td>
            <td>{{ r.material_type|title }}</td>
            <td>
              <strong>{{ r.name }}</strong>
            </td>
            <td>{{r.grade}}
            </td>
            <td class="muted">{{ r.form }}</td>
            <td class="muted">
              {% if r.thickness_in is not none %}{{ "%.4f"|format(r.thickness_in) }}"{% endif %}
            </td>
            <td class="muted">
              {% if r.width_in is not none and r.length_in is not none %}
                {{ "%.2f"|format(r.width_in) }}" √ó {{ "%.2f"|format(r.length_in) }}"
              {% endif %}
            </td>
            <td>
              {{ qty_map.get(r.id, 0) }} {{ r.uom }}
            </td>

            <td class="muted">{{ r.location or "" }}</td>
            <td class="muted">
                <form method="POST"
                      action="{{ url_for('inventory_bp.raw_stock_adjust', item_id=r.id) }}"
                      style="display:inline-flex; gap:6px; align-items:center;">
                  <input type="number" name="qty_delta" step="0.0001" placeholder="+/-" style="width:90px;">
                  
                  <button class="btn btn-sm" type="submit">Adjust</button>
                </form>
            </td>

          </tr>
        {% else %}
          <tr>
            <td colspan="8" class="muted">No raw stock items yet.</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
