<!-- File path: templates/inventory/catalog/index.html -->

{% extends "base.html" %}

{% import "_macros/sort.html" as sort %}

{% block topbar %}
üì¶ Inventory
{% endblock %}

{% block toplinks %}
  <span class="page-links">
    <a class="btn btn-secondary" href="{{ url_for('inventory_bp.inventory_index') }}">‚Üê Inventory</a>
    <a class="btn btn-primary" href="{{ url_for('inventory_bp.raw_stock_index') }}">Raw Stock</a>
    <a class="btn btn-primary" href="{{ url_for('inventory_bp.bulk_index') }}">Bulk Hardware</a>
    <a class="btn btn-primary" href="{{ url_for('inventory_bp.parts_inventory_index') }}">Parts Inventory</a>
  </span>
  {{ super() }}
{% endblock %}


{% block content %}
<div class="page-header" style="margin:0 0 10px 0;">
    <div>
      <h1 class="page-title">üì¶ Catalog</h1>
      <p class="page-subtitle">Catalog of Stock items and Parts.</p>
    </div>

</div>

<form method="get" class="mb-3">
  <input type="text" name="q" value="{{ search }}" placeholder="Search‚Ä¶" />
  <label>
    <input type="checkbox" name="show" value="all" {% if include_inactive %}checked{% endif %}>
    Show inactive
  </label>
  <button class="btn btn-ghost" type="submit">Filter</button>
</form>

<div class="card" style="margin: 10px 0 0 0;">
    <table class="table">
      <thead>
        <tr>
          <th>{{ sort.sort_th('Code', 'code', 'inventory_bp.inventory_catalog') }}</th>
          <th>{{ sort.sort_th('Name', 'name', 'inventory_bp.inventory_catalog') }}</th>
          <th>{{ sort.sort_th('Item Class', 'class', 'inventory_bp.inventory_catalog') }}</th>
          <th>UOM</th>
          <th>Qty</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for r in rows %}
        <tr>
          <td>{{ r.code }}</td>
          <td>{{ r.name }}</td>
          <td>
            {% if r.item_type == "raw" %}Raw Stock
            {% elif r.item_type == "bulk" %}Bulk Hardware
            {% elif r.item_type == "part" %}Part
            {% else %}{{ r.item_type }}
            {% endif %}
          </td>
          <td>{{ r.uom }}</td>
          <td>
            {{ r.qty_total }}
            {% if r.item_type == "part" and r.stage_map %}
              <details>
                <summary>stages</summary>
                <ul>
                  {% for k, v in r.stage_map.items() %}
                    <li>{{ k }}: {{ v }}</li>
                  {% endfor %}
                </ul>
              </details>
            {% endif %}
          </td>
          <td>{{ r.status }}</td>
          <td>
              {% if r.item_type == "bulk" %}
                <a class="btn" href="{{ url_for('inventory_bp.stock_history', entity_type='bulk_hardware', entity_id=r.id) }}">History</a>
              {% elif r.item_type == "raw" %}
                <a class="btn" href="{{ url_for('inventory_bp.stock_history', entity_type='raw_stock', entity_id=r.id) }}">History</a>
              {% else %}
                <span class="muted">‚Äî</span>
              {% endif %}
            </td>

        </tr>
        {% endfor %}
      </tbody>
    </table>
</div>    
{% endblock %}
