<!-- File path: templates/work_orders/work_orders/apply.html -->
{% extends "base.html" %}

{% block title %}Apply Work Order{% endblock %}
{% block topbar %}üë• Work Orders ‚Äî Apply WO{% endblock %}

{% block content %}
<div class="page">

  <div class="page-header">
    <div>
      <h1 class="page-title">Apply {{ wo.wo_number }}</h1>
      <p class="page-subtitle">
        This will create a new Job + Build run, copy WO lines into BOM items, then generate released operations.
      </p>
    </div>

    <div class="row" style="gap: 10px; flex-wrap: wrap;">
      <a class="btn" href="{{ url_for('work_orders_bp.wo_detail', wo_id=wo.id) }}">‚Üê Back</a>
    </div>
  </div>

  <div class="card" style="max-width: 980px;">
    <h2 style="margin:0 0 10px 0;">Summary</h2>
    <div class="row" style="gap:16px; flex-wrap:wrap;">
      <div><strong>Lines:</strong> {{ total_lines }}</div>
      <div><strong>Total Qty (sum):</strong> {{ "%.4f"|format(total_qty) }}</div>
      <div><strong>Status:</strong> <span class="badge">{{ wo.status }}</span></div>
    </div>
  </div>

  <div class="card" style="overflow:auto; margin-top: 14px;">
    <h2 style="margin:0 0 10px 0;">WO Lines</h2>
    <table class="table">
      <thead>
        <tr>
          <th>Line</th>
          <th>Part</th>
          <th>Qty</th>
          <th>Config</th>
        </tr>
      </thead>
      <tbody>
        {% for l in lines %}
        <tr>
          <td>{{ l.line_no }}</td>
          <td>
            <div><strong>{{ l.part_number }}</strong></div>
            <div class="muted">{{ l.name }}</div>
          </td>
          <td>{{ "%.4f"|format(l.qty_requested) }} {{ l.unit }}</td>
          <td class="muted">{{ l.config_key or "" }}</td>
        </tr>
        {% else %}
        <tr><td colspan="4" class="muted">No lines.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="row" style="gap: 10px; margin-top: 14px;">
    <form method="POST" action="{{ url_for('work_orders_bp.wo_apply_execute', wo_id=wo.id) }}"
          onsubmit="return confirm('Create a new Build run and generate operations?');">
      <button class="btn primary" type="submit">‚úÖ Apply Work Order</button>
    </form>
    <a class="btn" href="{{ url_for('work_orders_bp.wo_detail', wo_id=wo.id) }}">Cancel</a>
  </div>

</div>
{% endblock %}
